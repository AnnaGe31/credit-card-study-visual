<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Credit Card Payment Demo</title>

<!-- CSS Connection -->
<link rel="stylesheet" href="styles.css">

</head>
<body>
<div class="wrap">
  <header>
    <h1>Credit Card Payment Calculator</h1>
    <p class="sub">
      Click a payment option to view the total payoff time and total payment amount. Afterwards, please make your payment choice below this calculator.
    </p>
  </header>

  <main class="card" role="region" aria-label="Calculator">
    <!-- Payment Options -->
    <section aria-labelledby="options-title">
      <h2 id="options-title" style="margin:0 0 8px; font-size:1.1rem;">
        Choose Your Monthly Payment Amount
      </h2>

      <div class="options">
        <label>
          <input type="radio" name="payOption" value="1836.90">
          Statement Balance (as of 02/01/2026): $1836.90
        </label>
        <label>
          <input type="radio" name="payOption" value="1875.11">
          Current Balance: $1875.11
        </label>
        <label>
          <input type="radio" name="payOption" value="38.00">
          Minimum Payment Due: $38.00
        </label>
        <label>
          <input type="radio" name="payOption" value="other">
          Other Amount (Must be greater than $38):
          <input id="paymentInput" type="number" min="38" max="1875.11" step="0.01" placeholder="Enter amount" />
          <div id="errorMessage" style="color: #dc2626; font-size: 0.85rem; margin-top: 4px; display: none; font-weight: normal;">
            ⚠️ Payment must be at least $38.00 (the minimum payment due)
          </div>
        </label>
      </div>

      <!-- Slider box -->
      <h2 id="options-title" style="margin:0 0 8px; font-size:1.1rem;">
        Use the Slider to Find Out Details of Your Payment ⬇️
      </h2>
      <div class="slider-box" id="sliderBox">
        <p>
          If you pay <strong>$<span id="descPayment">-</span></strong> each month and make no new charges,
          you will pay off your current balance in <strong><span id="descYears">—</span></strong>,
          for a total payment of <strong>$<span id="descTotal">—</span></strong>.
        </p>
        <input id="paymentRange" type="range" min="38" max="1875.11" step="0.01" value="38" />
      </div>

    </section>

    <!-- Results -->
    <section aria-labelledby="results-title">
      <h2 id="results-title" style="margin:16px 0 8px; font-size:1.1rem;">
        Estimated Payoff Summary
      </h2>
      <div class="results" role="status" aria-live="polite">
        <div class="stat">
          <div class="k">Estimated Time to Pay Off</div>
          <div class="v" id="yearsOut">—</div>
        </div>
        <div class="stat">
          <div class="k">Total Amount Paid (Principal + Interest)</div>
          <div class="v" id="totalOut">—</div>
        </div>
      </div>
      <p style="font-size:0.9rem; color:#6b7280; margin-top:6px;">
        *Calculations assume a 21% annual interest rate and no additional charges.
      </p>

      <!-- Graphs -->
      <div class="graph-section">
        <h3 style="margin-bottom:8px; font-size:1rem;">Cumulative Total Payment Over Time</h3>
        <div class="chart-wrap">
          <div class="chart-box">
            <!-- <div style="flex:1; min-width:300px;">
              <canvas id="balanceChart" height="200"></canvas>
            </div> -->
              <canvas id="stackedChart"></canvas>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>Demo Website for Research Use Only</footer>
</div>

<script>
  let isTyping = false;
  
  // --- Constants (Oct 2025 update) ---
  const STATEMENT_BALANCE = 1836.90;
  const CURRENT_BALANCE   = 1875.11;
  const MIN_PAYMENT       = 38.00;
  const ANNUAL_RATE       = 0.21;
  const MONTHLY_RATE      = ANNUAL_RATE / 12;

  const paymentRange = document.getElementById('paymentRange');
  const paymentInput = document.getElementById('paymentInput');
  const yearsOut     = document.getElementById('yearsOut');
  const totalOut     = document.getElementById('totalOut');
  const sliderBox    = document.getElementById('sliderBox');
  const descPayment  = document.getElementById('descPayment');
  const descYears    = document.getElementById('descYears');
  const descTotal    = document.getElementById('descTotal');

  function compute(payment){
    const balance = CURRENT_BALANCE;
    const monthlyPayment = Math.max(0, Number(payment) || 0);
    if (monthlyPayment <= balance * MONTHLY_RATE) return { pay: monthlyPayment, years: Infinity, total: Infinity };
    if (monthlyPayment >= balance) return { pay: monthlyPayment, years: 0, total: balance };
    const months = Math.log(monthlyPayment / (monthlyPayment - MONTHLY_RATE * balance)) / Math.log(1 + MONTHLY_RATE);
    const years = months / 12;
    const total = monthlyPayment * months;
    return { pay: monthlyPayment, years, total };
  }

  function updateDisplay(pay, total) {
    const formattedPay = pay.toFixed(2);
    const formattedTotal = total.toFixed(2);
  
    totalOut.textContent    = `$${formattedTotal}`;
    descPayment.textContent = formattedPay;
    descTotal.textContent   = formattedTotal;
    paymentRange.value      = Math.min(pay, CURRENT_BALANCE).toFixed(2);
  
    // Only update text box if "Other Amount" is selected and user isn't typing
    const otherRadio = document.querySelector('input[name="payOption"][value="other"]');
    if (!isTyping && otherRadio && otherRadio.checked) {
      paymentInput.value = formattedPay;
    }
  }

  function render(payment) {
    if (!payment || isNaN(payment) || payment <= 0) return;

    const { pay, years, total } = compute(payment);
    updateDisplay(pay, total);

    if (!isFinite(years)) {
      yearsOut.textContent = "—";
      descYears.textContent = "—";
      return;
    }

    const totalMonths = Math.ceil(years * 12);
    let timeText = "";

    if (totalMonths <= 0) {
      timeText = "0 months";
    } else if (totalMonths < 12) {
      timeText = totalMonths === 1 ? "1 month" : `${totalMonths} months`;
    } else {
      const wholeYears = Math.floor(totalMonths / 12);
      const remainingMonths = totalMonths % 12;
      if (remainingMonths === 0) {
        timeText = wholeYears === 1 ? "1 year" : `${wholeYears} years`;
      } else {
        timeText = `${wholeYears} years and ${remainingMonths} months`;
      }
    }

    yearsOut.textContent = totalMonths <= 12 ? timeText : `${timeText} (${totalMonths} months)`;
    descYears.textContent = totalMonths <= 1 ? timeText : `about ${timeText}`;

    updateCharts(payment);
  }

  paymentRange.addEventListener('input', e => {
    let val = +e.target.value;
    if (Math.abs(val - CURRENT_BALANCE) < 0.1) val = CURRENT_BALANCE;
    render(val);
  });

  paymentInput.addEventListener('focus', () => { isTyping = true; });

  paymentInput.addEventListener('input', e => {
    // Auto-select "Other Amount" radio when user types
    const otherRadio = document.querySelector('input[name="payOption"][value="other"]');
    if (otherRadio && !otherRadio.checked) {
      otherRadio.checked = true;
    }
    
    const val = parseFloat(e.target.value);
    const errorMessage = document.getElementById('errorMessage');
    
    // Check if value is less than minimum
    if (!isNaN(val) && val < MIN_PAYMENT) {
      errorMessage.style.display = 'block';
      // Don't render calculations for invalid amounts
      return;
    } else {
      errorMessage.style.display = 'none';
    }
    
    if (!isNaN(val)) render(val);
  });

  document.querySelectorAll('input[name="payOption"]').forEach(radio => {
    radio.addEventListener('change', () => {
      if (radio.value === 'other') {
        const val = +paymentInput.value;
        if (!val) return;
        paymentRange.value = val;
        render(val);
      } else {
        paymentRange.value = radio.value;
        render(+radio.value);
      }
    });
  });

  window.addEventListener('DOMContentLoaded', () => {});
  
  let balanceChart, stackedChart;

  function updateCharts(payment) {
    const { pay, years } = compute(payment);
    if (!isFinite(years)) return;

    const months = Math.ceil(years * 12);
    
    // Create labels showing all months
    const labels = Array.from({ length: months }, (_, i) => {
      const monthNum = i + 1;
      return `${monthNum}`;
    });

    let balance = CURRENT_BALANCE;
    const cumulativeTotalPayments = [];
    const cumulativeInterest = [];
    const cumulativePrincipal = [];
    let totalPaidSoFar = 0;
    let totalInterestSoFar = 0;
    let totalPrincipalSoFar = 0;

    for (let m = 1; m <= months; m++) {
      const interest = balance * MONTHLY_RATE;
      const principal = Math.min(pay - interest, balance);
      balance -= principal;
      
      // Accumulate totals
      totalInterestSoFar += interest;
      totalPrincipalSoFar += principal;
      totalPaidSoFar += (principal + interest);
      
      cumulativeInterest.push(totalInterestSoFar);
      cumulativePrincipal.push(totalPrincipalSoFar);
      cumulativeTotalPayments.push(totalPaidSoFar);
    }

    const stkCtx = document.getElementById("stackedChart").getContext("2d");

    if (stackedChart) stackedChart.destroy();

    stackedChart = new Chart(stkCtx, {
      type: "bar",
      data: {
        labels,
        datasets: [
          { label: "Cumulative Interest", data: cumulativeInterest, backgroundColor: "#EAAA00" },
          { label: "Cumulative Principal", data: cumulativePrincipal, backgroundColor: "#8A100B" }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            stacked: true,
            title: {
              display: true,
              text: 'Month',
              font: {
                size: 13,
                weight: '500'
              }
            },
            ticks: {
              autoSkip: true,
              maxTicksLimit: 20
            }
          },
          y: {
            stacked: true,
            title: {
              display: true,
              text: 'Total Payment ($)',
              font: {
                size: 13,
                weight: '500'
              }
            },
            ticks: {
              callback: function(value) {
                return '$' + value.toFixed(0);
              }
            }
          }
        },
        barPercentage: 0.995,
        categoryPercentage: 0.995
      }
    });
  }
</script>
</body>
</html>
